function cov_1rxcxypdjz(){var path="/Users/usuario/Projects/NodeJS/movies-api/lib/mongo.js";var hash="af4263f12c06aaf8110d82041630f3072a2060cd";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/usuario/Projects/NodeJS/movies-api/lib/mongo.js",statementMap:{"0":{start:{line:1,column:34},end:{line:1,column:52}},"1":{start:{line:2,column:19},end:{line:2,column:39}},"2":{start:{line:4,column:13},end:{line:4,column:46}},"3":{start:{line:5,column:17},end:{line:5,column:54}},"4":{start:{line:6,column:16},end:{line:6,column:29}},"5":{start:{line:8,column:18},end:{line:8,column:126}},"6":{start:{line:12,column:4},end:{line:12,column:72}},"7":{start:{line:13,column:4},end:{line:13,column:26}},"8":{start:{line:17,column:4},end:{line:28,column:5}},"9":{start:{line:18,column:6},end:{line:27,column:9}},"10":{start:{line:19,column:8},end:{line:26,column:11}},"11":{start:{line:20,column:10},end:{line:22,column:11}},"12":{start:{line:21,column:12},end:{line:21,column:24}},"13":{start:{line:24,column:10},end:{line:24,column:56}},"14":{start:{line:25,column:10},end:{line:25,column:47}},"15":{start:{line:30,column:4},end:{line:30,column:31}},"16":{start:{line:34,column:4},end:{line:36,column:7}},"17":{start:{line:35,column:6},end:{line:35,column:61}},"18":{start:{line:40,column:4},end:{line:44,column:7}},"19":{start:{line:41,column:6},end:{line:43,column:39}},"20":{start:{line:48,column:4},end:{line:52,column:43}},"21":{start:{line:50,column:8},end:{line:50,column:57}},"22":{start:{line:52,column:24},end:{line:52,column:41}},"23":{start:{line:56,column:4},end:{line:62,column:49}},"24":{start:{line:58,column:8},end:{line:60,column:78}},"25":{start:{line:62,column:24},end:{line:62,column:47}},"26":{start:{line:66,column:4},end:{line:73,column:22}},"27":{start:{line:68,column:8},end:{line:71,column:21}},"28":{start:{line:73,column:18},end:{line:73,column:20}},"29":{start:{line:77,column:0},end:{line:77,column:26}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:11,column:2},end:{line:11,column:3}},loc:{start:{line:11,column:16},end:{line:14,column:3}},line:11},"1":{name:"(anonymous_1)",decl:{start:{line:16,column:2},end:{line:16,column:3}},loc:{start:{line:16,column:12},end:{line:31,column:3}},line:16},"2":{name:"(anonymous_2)",decl:{start:{line:18,column:40},end:{line:18,column:41}},loc:{start:{line:18,column:61},end:{line:27,column:7}},line:18},"3":{name:"(anonymous_3)",decl:{start:{line:19,column:28},end:{line:19,column:29}},loc:{start:{line:19,column:37},end:{line:26,column:9}},line:19},"4":{name:"(anonymous_4)",decl:{start:{line:33,column:2},end:{line:33,column:3}},loc:{start:{line:33,column:28},end:{line:37,column:3}},line:33},"5":{name:"(anonymous_5)",decl:{start:{line:34,column:31},end:{line:34,column:32}},loc:{start:{line:34,column:39},end:{line:36,column:5}},line:34},"6":{name:"(anonymous_6)",decl:{start:{line:39,column:2},end:{line:39,column:3}},loc:{start:{line:39,column:22},end:{line:45,column:3}},line:39},"7":{name:"(anonymous_7)",decl:{start:{line:40,column:31},end:{line:40,column:32}},loc:{start:{line:40,column:39},end:{line:44,column:5}},line:40},"8":{name:"(anonymous_8)",decl:{start:{line:47,column:2},end:{line:47,column:3}},loc:{start:{line:47,column:27},end:{line:53,column:3}},line:47},"9":{name:"(anonymous_9)",decl:{start:{line:49,column:12},end:{line:49,column:13}},loc:{start:{line:49,column:20},end:{line:51,column:7}},line:49},"10":{name:"(anonymous_10)",decl:{start:{line:52,column:12},end:{line:52,column:13}},loc:{start:{line:52,column:24},end:{line:52,column:41}},line:52},"11":{name:"(anonymous_11)",decl:{start:{line:55,column:2},end:{line:55,column:3}},loc:{start:{line:55,column:31},end:{line:63,column:3}},line:55},"12":{name:"(anonymous_12)",decl:{start:{line:57,column:12},end:{line:57,column:13}},loc:{start:{line:57,column:20},end:{line:61,column:7}},line:57},"13":{name:"(anonymous_13)",decl:{start:{line:62,column:12},end:{line:62,column:13}},loc:{start:{line:62,column:24},end:{line:62,column:47}},line:62},"14":{name:"(anonymous_14)",decl:{start:{line:65,column:2},end:{line:65,column:3}},loc:{start:{line:65,column:25},end:{line:74,column:3}},line:65},"15":{name:"(anonymous_15)",decl:{start:{line:67,column:12},end:{line:67,column:13}},loc:{start:{line:67,column:20},end:{line:72,column:7}},line:67},"16":{name:"(anonymous_16)",decl:{start:{line:73,column:12},end:{line:73,column:13}},loc:{start:{line:73,column:18},end:{line:73,column:20}},line:73}},branchMap:{"0":{loc:{start:{line:17,column:4},end:{line:28,column:5}},type:"if",locations:[{start:{line:17,column:4},end:{line:28,column:5}},{start:{line:17,column:4},end:{line:28,column:5}}],line:17},"1":{loc:{start:{line:20,column:10},end:{line:22,column:11}},type:"if",locations:[{start:{line:20,column:10},end:{line:22,column:11}},{start:{line:20,column:10},end:{line:22,column:11}}],line:20},"2":{loc:{start:{line:62,column:24},end:{line:62,column:47}},type:"binary-expr",locations:[{start:{line:62,column:24},end:{line:62,column:41}},{start:{line:62,column:45},end:{line:62,column:47}}],line:62}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"af4263f12c06aaf8110d82041630f3072a2060cd"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_1rxcxypdjz=function(){return actualCoverage;};return actualCoverage;}cov_1rxcxypdjz();const{MongoClient,ObjectId}=(cov_1rxcxypdjz().s[0]++,require('mongodb'));const{config}=(cov_1rxcxypdjz().s[1]++,require('../config'));const USER=(cov_1rxcxypdjz().s[2]++,encodeURIComponent(config.dbUser));const PASSWORD=(cov_1rxcxypdjz().s[3]++,encodeURIComponent(config.dbPassword));const DB_NAME=(cov_1rxcxypdjz().s[4]++,config.dbName);const MONGO_URI=(cov_1rxcxypdjz().s[5]++,`mongodb+srv://${USER}:${PASSWORD}@${config.dbHost}:${config.dbPort}/${DB_NAME}?retryWrites=true&w=majority`);class MongoLib{constructor(){cov_1rxcxypdjz().f[0]++;cov_1rxcxypdjz().s[6]++;this.client=new MongoClient(MONGO_URI,{useNewUrlParser:true});cov_1rxcxypdjz().s[7]++;this.dbName=DB_NAME;}connect(){cov_1rxcxypdjz().f[1]++;cov_1rxcxypdjz().s[8]++;if(!MongoLib.connection){cov_1rxcxypdjz().b[0][0]++;cov_1rxcxypdjz().s[9]++;MongoLib.connection=new Promise((resolve,reject)=>{cov_1rxcxypdjz().f[2]++;cov_1rxcxypdjz().s[10]++;this.client.connect(err=>{cov_1rxcxypdjz().f[3]++;cov_1rxcxypdjz().s[11]++;if(err){cov_1rxcxypdjz().b[1][0]++;cov_1rxcxypdjz().s[12]++;reject(err);}else{cov_1rxcxypdjz().b[1][1]++;}cov_1rxcxypdjz().s[13]++;console.log('Connected succesfully to mongo');cov_1rxcxypdjz().s[14]++;resolve(this.client.db(this.dbName));});});}else{cov_1rxcxypdjz().b[0][1]++;}cov_1rxcxypdjz().s[15]++;return MongoLib.connection;}getAll(collection,query){cov_1rxcxypdjz().f[4]++;cov_1rxcxypdjz().s[16]++;return this.connect().then(db=>{cov_1rxcxypdjz().f[5]++;cov_1rxcxypdjz().s[17]++;return db.collection(collection).find(query).toArray();});}get(collection,id){cov_1rxcxypdjz().f[6]++;cov_1rxcxypdjz().s[18]++;return this.connect().then(db=>{cov_1rxcxypdjz().f[7]++;cov_1rxcxypdjz().s[19]++;return db.collection(collection).findOne({_id:ObjectId(id)});// IMPORTANTE
});}create(collection,data){cov_1rxcxypdjz().f[8]++;cov_1rxcxypdjz().s[20]++;return this.connect().then(db=>{cov_1rxcxypdjz().f[9]++;cov_1rxcxypdjz().s[21]++;return db.collection(collection).insertOne(data);}).then(result=>{cov_1rxcxypdjz().f[10]++;cov_1rxcxypdjz().s[22]++;return result.insertedId;});}update(collection,id,data){cov_1rxcxypdjz().f[11]++;cov_1rxcxypdjz().s[23]++;return this.connect().then(db=>{cov_1rxcxypdjz().f[12]++;cov_1rxcxypdjz().s[24]++;return db.collection(collection).updateOne({_id:ObjectId(id)},{$set:data},{upsert:true});// Si existe lo edita sino lo inserta
}).then(result=>{cov_1rxcxypdjz().f[13]++;cov_1rxcxypdjz().s[25]++;return(cov_1rxcxypdjz().b[2][0]++,result.upsertedId)||(cov_1rxcxypdjz().b[2][1]++,id);});}delete(collection,id){cov_1rxcxypdjz().f[14]++;cov_1rxcxypdjz().s[26]++;return this.connect().then(db=>{cov_1rxcxypdjz().f[15]++;cov_1rxcxypdjz().s[27]++;return db.collection(collection).deleteOne({_id:ObjectId(id)}).toArray();}).then(()=>{cov_1rxcxypdjz().f[16]++;cov_1rxcxypdjz().s[28]++;return id;});}}cov_1rxcxypdjz().s[29]++;module.exports=MongoLib;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vbmdvLmpzIl0sIm5hbWVzIjpbIk1vbmdvQ2xpZW50IiwiT2JqZWN0SWQiLCJyZXF1aXJlIiwiY29uZmlnIiwiVVNFUiIsImVuY29kZVVSSUNvbXBvbmVudCIsImRiVXNlciIsIlBBU1NXT1JEIiwiZGJQYXNzd29yZCIsIkRCX05BTUUiLCJkYk5hbWUiLCJNT05HT19VUkkiLCJkYkhvc3QiLCJkYlBvcnQiLCJNb25nb0xpYiIsImNvbnN0cnVjdG9yIiwiY2xpZW50IiwidXNlTmV3VXJsUGFyc2VyIiwiY29ubmVjdCIsImNvbm5lY3Rpb24iLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJkYiIsImdldEFsbCIsImNvbGxlY3Rpb24iLCJxdWVyeSIsInRoZW4iLCJmaW5kIiwidG9BcnJheSIsImdldCIsImlkIiwiZmluZE9uZSIsIl9pZCIsImNyZWF0ZSIsImRhdGEiLCJpbnNlcnRPbmUiLCJyZXN1bHQiLCJpbnNlcnRlZElkIiwidXBkYXRlIiwidXBkYXRlT25lIiwiJHNldCIsInVwc2VydCIsInVwc2VydGVkSWQiLCJkZWxldGUiLCJkZWxldGVPbmUiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiMnBMQUFBLEtBQU0sQ0FBRUEsV0FBRixDQUFlQyxRQUFmLDJCQUE0QkMsT0FBTyxDQUFDLFNBQUQsQ0FBbkMsQ0FBTixDQUNBLEtBQU0sQ0FBRUMsTUFBRiwyQkFBYUQsT0FBTyxDQUFDLFdBQUQsQ0FBcEIsQ0FBTixDQUVBLEtBQU1FLENBQUFBLElBQUksMEJBQUdDLGtCQUFrQixDQUFDRixNQUFNLENBQUNHLE1BQVIsQ0FBckIsQ0FBVixDQUNBLEtBQU1DLENBQUFBLFFBQVEsMEJBQUdGLGtCQUFrQixDQUFDRixNQUFNLENBQUNLLFVBQVIsQ0FBckIsQ0FBZCxDQUNBLEtBQU1DLENBQUFBLE9BQU8sMEJBQUdOLE1BQU0sQ0FBQ08sTUFBVixDQUFiLENBRUEsS0FBTUMsQ0FBQUEsU0FBUywwQkFB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QUFiLENBQWlCLG1EQUNyQixNQUFPLE1BQUtoQixPQUFMLEdBQ0pZLElBREksQ0FDRUosRUFBRCxFQUFRLG1EQUNaLE1BQU9BLENBQUFBLEVBQUUsQ0FDTkUsVUFESSxDQUNPQSxVQURQLEVBRUpvQixTQUZJLENBRU0sQ0FBRVosR0FBRyxDQUFFbkMsUUFBUSxDQUFDaUMsRUFBRCxDQUFmLENBRk4sRUFHSkYsT0FISSxFQUFQLENBSUQsQ0FOSSxFQU9KRixJQVBJLENBT0MsSUFBTUkseURBQUFBLENBQUFBLEVBQUUsRUFQVCxDQUFQLENBUUQsQ0FoRVksQyx5QkFtRWZlLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQnBDLFFBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBNb25nb0NsaWVudCwgT2JqZWN0SWQgfSA9IHJlcXVpcmUoJ21vbmdvZGInKTtcbmNvbnN0IHsgY29uZmlnIH0gPSByZXF1aXJlKCcuLi9jb25maWcnKTtcblxuY29uc3QgVVNFUiA9IGVuY29kZVVSSUNvbXBvbmVudChjb25maWcuZGJVc2VyKTtcbmNvbnN0IFBBU1NXT1JEID0gZW5jb2RlVVJJQ29tcG9uZW50KGNvbmZpZy5kYlBhc3N3b3JkKTtcbmNvbnN0IERCX05BTUUgPSBjb25maWcuZGJOYW1lO1xuXG5jb25zdCBNT05HT19VUkkgPSBgbW9uZ29kYitzcnY6Ly8ke1VTRVJ9OiR7UEFTU1dPUkR9QCR7Y29uZmlnLmRiSG9zdH06JHtjb25maWcuZGJQb3J0fS8ke0RCX05BTUV9P3JldHJ5V3JpdGVzPXRydWUmdz1tYWpvcml0eWA7XG5cbmNsYXNzIE1vbmdvTGliIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jbGllbnQgPSBuZXcgTW9uZ29DbGllbnQoTU9OR09fVVJJLCB7IHVzZU5ld1VybFBhcnNlcjogdHJ1ZSB9KTtcbiAgICB0aGlzLmRiTmFtZSA9IERCX05BTUU7XG4gIH1cblxuICBjb25uZWN0KCkge1xuICAgIGlmICghTW9uZ29MaWIuY29ubmVjdGlvbikge1xuICAgICAgTW9uZ29MaWIuY29ubmVjdGlvbiA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgdGhpcy5jbGllbnQuY29ubmVjdCgoZXJyKSA9PiB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc29sZS5sb2coJ0Nvbm5lY3RlZCBzdWNjZXNmdWxseSB0byBtb25nbycpO1xuICAgICAgICAgIHJlc29sdmUodGhpcy5jbGllbnQuZGIodGhpcy5kYk5hbWUpKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gTW9uZ29MaWIuY29ubmVjdGlvbjtcbiAgfVxuXG4gIGdldEFsbChjb2xsZWN0aW9uLCBxdWVyeSkge1xuICAgIHJldHVybiB0aGlzLmNvbm5lY3QoKS50aGVuKChkYikgPT4ge1xuICAgICAgcmV0dXJuIGRiLmNvbGxlY3Rpb24oY29sbGVjdGlvbikuZmluZChxdWVyeSkudG9BcnJheSgpO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0KGNvbGxlY3Rpb24sIGlkKSB7XG4gICAgcmV0dXJuIHRoaXMuY29ubmVjdCgpLnRoZW4oKGRiKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLmNvbGxlY3Rpb24oY29sbGVjdGlvbilcbiAgICAgICAgLmZpbmRPbmUoeyBfaWQ6IE9iamVjdElkKGlkKSB9KSAvLyBJTVBPUlRBTlRFXG4gICAgfSk7XG4gIH1cblxuICBjcmVhdGUoY29sbGVjdGlvbiwgZGF0YSkge1xuICAgIHJldHVybiB0aGlzLmNvbm5lY3QoKVxuICAgICAgLnRoZW4oKGRiKSA9PiB7XG4gICAgICAgIHJldHVybiBkYi5jb2xsZWN0aW9uKGNvbGxlY3Rpb24pLmluc2VydE9uZShkYXRhKTtcbiAgICAgIH0pXG4gICAgICAudGhlbigocmVzdWx0KSA9PiByZXN1bHQuaW5zZXJ0ZWRJZCk7XG4gIH1cblxuICB1cGRhdGUoY29sbGVjdGlvbiwgaWQsIGRhdGEpIHtcbiAgICByZXR1cm4gdGhpcy5jb25uZWN0KClcbiAgICAgIC50aGVuKChkYikgPT4ge1xuICAgICAgICByZXR1cm4gZGJcbiAgICAgICAgICAuY29sbGVjdGlvbihjb2xsZWN0aW9uKVxuICAgICAgICAgIC51cGRhdGVPbmUoeyBfaWQ6IE9iamVjdElkKGlkKSB9LCB7ICRzZXQ6IGRhdGEgfSwgeyB1cHNlcnQ6IHRydWUgfSk7IC8vIFNpIGV4aXN0ZSBsbyBlZGl0YSBzaW5vIGxvIGluc2VydGFcbiAgICAgIH0pXG4gICAgICAudGhlbigocmVzdWx0KSA9PiByZXN1bHQudXBzZXJ0ZWRJZCB8fCBpZCk7XG4gIH1cblxuICBkZWxldGUoY29sbGVjdGlvbiwgaWQpIHtcbiAgICByZXR1cm4gdGhpcy5jb25uZWN0KClcbiAgICAgIC50aGVuKChkYikgPT4ge1xuICAgICAgICByZXR1cm4gZGJcbiAgICAgICAgICAuY29sbGVjdGlvbihjb2xsZWN0aW9uKVxuICAgICAgICAgIC5kZWxldGVPbmUoeyBfaWQ6IE9iamVjdElkKGlkKSB9KVxuICAgICAgICAgIC50b0FycmF5KCk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oKCkgPT4gaWQpO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gTW9uZ29MaWI7XG4iXX0=